<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-62096468-4','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#326CE5"><title>KubeVault by AppsCode</title><meta name=description content="Tools for running HashiCorp Vault on Kubernetes"><meta name=author content="AppsCode Inc."><meta name=keywords content="kubernetes appscode vault secret csi security"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/kubevault/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/kubevault/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/kubevault/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/kubevault/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/kubevault/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/kubevault/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/kubevault/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/kubevault/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/kubevault/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/kubevault/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/kubevault/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/kubevault/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/kubevault/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/kubevault/icons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/images/products/kubevault/icons/ms-icon-144x144.png"><meta itemprop=name content="KubeVault by AppsCode"><meta itemprop=description content="Tools for running HashiCorp Vault on Kubernetes"><meta itemprop=image content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@kubevault"><meta name=twitter:title content="KubeVault by AppsCode"><meta name=twitter:creator content="@kubevault"><meta name=twitter:description content="Tools for running HashiCorp Vault on Kubernetes"><meta name=twitter:image:src content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta property="og:url" content="https://kubevault.com"><meta property="og:title" content="KubeVault by AppsCode"><meta property="og:description" content="Tools for running HashiCorp Vault on Kubernetes"><meta property="og:site_name" content="KubeVault by AppsCode"><meta property="og:image" content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/css/font-awesome.min.css><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=/assets/sass/main.min.8b1cf6186f0e12d4a91cc7f6ccc7db154302adadcdfef7fddaa3512566b5b3ae.css></head><body class=kubevault><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade Databases on Kubernetes</p></div></a><a href=https://stash.run class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://kubeform.cloud class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs & Terraform</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Open Source</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://voyagermesh.com class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://pharmer.cloud class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm & Cluster API</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://kubevault.com><img src=/assets/images/products/kubevault/kubevault-white.png alt=KubeVault></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/pricing/ class=navbar-item>Pricing</a>
<a href=/docs/v0.3.0/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/kubevault class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeVault class=navbar-item>Twitter</a>
<a href=https://slack.appscode.com class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=stars&query=%24.stars&url=https://github-stars.appscode.workers.dev/user/kubevault">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="GitHub Forks" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=forks&query=%24.forks&url=https://github-stars.appscode.workers.dev/user/kubevault">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/kubevault/vault-operator?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker&label=pulls"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/docs/v2020.07.09-beta.0/ class=navbar-item>Welcome</a>
<a href=/docs/v2020.07.09-beta.0/concepts/ class=navbar-item>Concepts</a>
<a href=/docs/v2020.07.09-beta.0/setup/ class=navbar-item>Setup</a>
<a href=/docs/v2020.07.09-beta.0/guides/ class="is-active navbar-item">Guides</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Reference</a><div class=ac-dropdown><a href=/docs/v2020.07.09-beta.0/reference/operator/ class=navbar-item>Vault Operator</a>
<a href=/docs/v2020.07.09-beta.0/reference/csi-driver/ class=navbar-item>Vault CSI Driver</a>
<a href=/docs/v2020.07.09-beta.0/reference/cli/ class=navbar-item>KubeVault CLI</a>
<a href=/docs/v2020.07.09-beta.0/reference/unsealer/ class=navbar-item>Vault Unsealer</a></div></div></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><article class="message is-danger"><div class=message-body>You are looking at the documentation of a prior release. To read the documentation of the latest release, please visit <a href=/docs/v0.3.0/guides/secret-engines/pki/csi-driver/>here</a>.</div></article><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v0.3.0/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/kubevault/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v0.3.0/ class=dropdown-item>v0.3.0<div class=tag>Latest</div></a><a href=/docs/0.2.0/ class=dropdown-item>0.2.0</a>
<a href=/docs/0.1.0/ class=dropdown-item>0.1.0</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-1>
<label for=8b60559afb43ead75db7c510dd509cd8-1><a href=/docs/v2020.07.09-beta.0/guides/>Guides</a></label></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-2>
<label for=8b60559afb43ead75db7c510dd509cd8-2><a>Vault Server</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server/>Vault Server</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/external-vault-sever/>External Vault Server</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-3>
<label for=8b60559afb43ead75db7c510dd509cd8-3><a>Policy Management</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/policy-management/overview/>Overview</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-4 checked>
<label for=8b60559afb43ead75db7c510dd509cd8-4><a>Secret Engines</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-5>
<label for=8b60559afb43ead75db7c510dd509cd8-5><a>AWS</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/aws/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/aws/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-6>
<label for=8b60559afb43ead75db7c510dd509cd8-6><a>Azure</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/azure/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/azure/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-7>
<label for=8b60559afb43ead75db7c510dd509cd8-7><a>GCP</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/gcp/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/gcp/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-8>
<label for=8b60559afb43ead75db7c510dd509cd8-8><a>Key/Value</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/kv/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/kv/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-9>
<label for=8b60559afb43ead75db7c510dd509cd8-9><a>MongoDB</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mongodb/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mongodb/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-10>
<label for=8b60559afb43ead75db7c510dd509cd8-10><a>MySQL</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mysql/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mysql/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-11 checked>
<label for=8b60559afb43ead75db7c510dd509cd8-11><a>PKI</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/pki/overview/>Overview</a></li><li class=is-active><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/pki/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-12>
<label for=8b60559afb43ead75db7c510dd509cd8-12><a>PostgreSQL</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/postgres/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/postgres/csi-driver/>CSI Driver</a></li></ul></div></div></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-13>
<label for=8b60559afb43ead75db7c510dd509cd8-13><a>Monitoring</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/overview/>Overview</a></li><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-14>
<label for=8b60559afb43ead75db7c510dd509cd8-14><a>Vault Server</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/builtin/>Builtin Prometheus</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/coreos/>Prometheus Operator</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/grafana/>Grafana Dashboard</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-15>
<label for=8b60559afb43ead75db7c510dd509cd8-15><a>CSI Driver</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/csi-driver/builtin/>Builtin Prometheus</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/csi-driver/coreos/>Prometheus Operator</a></li></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-16>
<label for=8b60559afb43ead75db7c510dd509cd8-16><a>KubeVault operator</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-operator/coreos/>Prometheus Operator</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-operator/builtin/>Builtin Prometheus</a></li></ul></div></div></ul></div></div><div class=item><input type=checkbox id=8b60559afb43ead75db7c510dd509cd8-17>
<label for=8b60559afb43ead75db7c510dd509cd8-17><a>Platforms</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/eks/>EKS</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/aks/>AKS</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/gke/>GKE</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/external-vault/>External Vault</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/multi-cluster-vault/>Multi-Cluster</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><blockquote><p>New to KubeVault? Please start <a href=/docs/v2020.07.09-beta.0/concepts/README>here</a>.</p></blockquote><h1 id=mount-pkicertificates-secrets-into-kubernetse-pod-using-csi-driver>Mount PKI(certificates) Secrets into Kubernetse pod using CSI Driver</h1><p>At first, you need to have a Kubernetes 1.14 or later cluster, and the kubectl command-line tool must be configured to communicate with your cluster. If you do not already have a cluster, you can create one by using <a href=https://kind.sigs.k8s.io/docs/user/quick-start/>kind</a>. To check the version of your cluster, run:</p><pre><code class=language-console data-lang=console>$ kubectl version --short
Client Version: v1.16.2
Server Version: v1.14.0
</code></pre><p>Before you begin:</p><ul><li>Install KubeVault operator in your cluster from <a href=/docs/v2020.07.09-beta.0/setup/operator/install>here</a>.</li><li>Install KubeVault CSI driver in your cluster from <a href=/docs/v2020.07.09-beta.0/setup/csi-driver/install>here</a>.</li></ul><p>To keep things isolated, we are going to use a separate namespace called <code>demo</code> throughout this tutorial.</p><pre><code class=language-console data-lang=console>$ kubectl create ns demo
namespace/demo created
</code></pre><blockquote><p>Note: YAML files used in this tutorial stored in <a href=/docs/v2020.07.09-beta.0/examples/guides/secret-engines/pki>examples</a> folder in GitHub repository <a href=https://github.com/kubevault/docs>KubeVault/docs</a></p></blockquote><h2 id=vault-server>Vault Server</h2><p>If you don&rsquo;t have a Vault Server, you can deploy it by using the KubeVault operator.</p><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server>Deploy Vault Server</a></li></ul><p>The KubeVault operator can manage policies and secret engines of Vault servers which are not provisioned by the KubeVault operator. You need to configure both the Vault server and the cluster so that the KubeVault operator can communicate with your Vault server.</p><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/external-vault-sever#configuration>Configure cluster and Vault server</a></li></ul><p>Now, we have the <a href=/docs/v2020.07.09-beta.0/concepts/vault-server-crds/auth-methods/appbinding>AppBinding</a> that contains connection and authentication information about the Vault server. And we also have the service account that the Vault server can authenticate.</p><pre><code class=language-console data-lang=console>$ kubectl get serviceaccounts -n demo
NAME                       SECRETS   AGE
vault                      1         20h

$ kubectl get appbinding -n demo
NAME    AGE
vault   50m

$ kubectl get appbinding -n demo vault -o yaml
apiVersion: appcatalog.appscode.com/v1alpha1
kind: AppBinding
metadata:
  name: vault
  namespace: demo
spec:
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN1RENDQWFDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFOTVFzd0NRWURWUVFERXdKallUQWUKRncweE9URXhNVEl3T1RFMU5EQmFGdzB5T1RFeE1Ea3dPVEUxTkRCYU1BMHhDekFKQmdOVkJBTVRBbU5oTUlJQgpJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdFZFZmtic2c2T085dnM2d1Z6bTlPQ1FYClBtYzBYTjlCWjNMbXZRTG0zdzZGaWF2aUlSS3VDVk1hN1NRSGo2L2YvOHZPeWhqNEpMcHhCM0hCYVFPZ3RrM2QKeEFDbHppU1lEd3dDbGEwSThxdklGVENLWndreXQzdHVQb0xybkppRFdTS2xJait6aFZDTHZ0enB4MDE3SEZadApmZEdhUUtlSXREUVdyNUV1QWlCMjhhSVF4WXREaVN6Y0h3OUdEMnkrblRMUEd4UXlxUlhua0d1UlIvR1B3R3lLClJ5cTQ5NmpFTmFjOE8wVERYRkIydWJQSFNza2xOU1VwSUN3S1IvR3BobnhGak1rWm4yRGJFZW9GWDE5UnhzUmcKSW94TFBhWDkrRVZxZU5jMlczN2MwQlhBSGwyMHVJUWQrVytIWDhnOVBVVXRVZW9uYnlHMDMvampvNERJRHdJRApBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lHCjl3MEJBUXNGQUFPQ0FRRUFabHRFN0M3a3ZCeTNzeldHY0J0SkpBTHZXY3ZFeUdxYUdCYmFUbGlVbWJHTW9QWXoKbnVqMUVrY1I1Qlg2YnkxZk15M0ZtZkJXL2E0NU9HcDU3U0RMWTVuc2w0S1RlUDdGZkFYZFBNZGxrV0lQZGpnNAptOVlyOUxnTThkOGVrWUJmN0paUkNzcEorYkpDU1A2a2p1V3l6MUtlYzBOdCtIU0psaTF3dXIrMWVyMUprRUdWClBQMzFoeTQ2RTJKeFlvbnRQc0d5akxlQ1NhTlk0UWdWK3ZneWJmSlFEMVYxbDZ4UlVlMzk2YkJ3aS94VGkzN0oKNWxTVklmb1kxcUlBaGJPbjBUWHp2YzBRRXBKUExaRDM2VDBZcEtJSVhjZUVGYXNxZzVWb1pINGx1Uk50SStBUAp0blg4S1JZU0xGOWlCNEJXd0N0aGFhZzZFZVFqYWpQNWlxZnZoUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    service:
      name: vault
      port: 8200
      scheme: HTTPS
  parameters:
    apiVersion: config.kubevault.com/v1alpha1
    kind: VaultServerConfiguration
    path: kubernetes
    vaultRole: vault-policy-controller
    kubernetes:
      serviceAccountName: vault
      tokenReviewerServiceAccountName: vault-k8s-token-reviewer
      usePodServiceAccountForCSIDriver: true
</code></pre><h2 id=enable-and-configure-pki-secret-engine>Enable and Configure PKI Secret Engine</h2><p>We will use the <a href=https://www.vaultproject.io/docs/commands/#vault-commands-cli->Vault CLI</a> throughout the tutorial to <a href=https://www.vaultproject.io/docs/secrets/pki/index.html#setup>enable and configure</a> the PKI secret engine.</p><blockquote><p>Don&rsquo;t have Vault CLI? Download and configure it as described <a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server#enable-vault-cli>here</a></p></blockquote><p>To use secret from <code>PKI</code> secret engine, you have to perform the following steps.</p><h3 id=enable-pki-secret-engine>Enable PKI Secret Engine</h3><p>To enable <code>PKI</code> secret engine run the following command.</p><pre><code class=language-console data-lang=console>$ vault secrets enable pki
Success! Enabled the pki secrets engine at: pki/
</code></pre><p>Increase the TTL by tuning the secrets engine. The default value of 30 days may be too short, so increase it to 1 year:</p><pre><code class=language-console data-lang=console>$ vault secrets tune -max-lease-ttl=8760h pki
Success! Tuned the secrets engine at: pki/
</code></pre><h3 id=configure-ca-certificate-and-private-key>Configure CA Certificate and Private Key</h3><p>Configure a CA certificate and private key. Vault can accept an existing key pair, or it can generate its own self-signed root.</p><pre><code class=language-console data-lang=console>$ vault write pki/root/generate/internal \
                          common_name=my-website.com \
                          ttl=8760h
Key              Value
---              -----
certificate      -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
expiration       1606200496
issuing_ca       -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
serial_number    10:39:a7:02:60:b4:b2:22:12:96:b7:b3:0f:7f:c2:79:45:d3:49:fb
</code></pre><h3 id=configure-a-pki-role>Configure a PKI Role</h3><p>We need to configure a role that maps a name in vault to a procedure for generating certificate. When users of machines generate credentials, they are generated agains this role:</p><pre><code class=language-console data-lang=console>$ vault write pki/roles/example-dot-com \
                          allowed_domains=my-website.com \
                          allow_subdomains=true \
                          max_ttl=72h
Success! Data written to: pki/roles/example-dot-com
</code></pre><h2 id=update-vault-policy>Update Vault Policy</h2><p>Since Pod&rsquo;s service account will be used by the CSI driver to perform <a href=https://www.vaultproject.io/docs/auth/kubernetes.html>Kubernetes authentication</a> to the Vault server, the auth method role must have the permission to read secret at <code>pki/*</code> path.</p><p>During the Vault server configuration, we have created a Kubernetes service account and registered an auth method role at the Vault server. If you have used the KubeVault operator to deploy the Vault server, then the operator has performed these tasks for you.</p><p>So, we have the service account that will be referenced from the Pod.</p><pre><code class=language-console data-lang=console>kubectl get serviceaccounts -n demo
NAME                       SECRETS   AGE
vault                      1         7h23m
</code></pre><blockquote><p>Don&rsquo;t have Vault CLI? Download and configure it as described <a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server#enable-vault-cli>here</a></p></blockquote><p>You can find the name of the auth method role in the AppBinding&rsquo;s <code>spec.parameters.vaultRole</code>. Let&rsquo;s list the token policies assigned for <code>vault</code> service account:</p><pre><code class=language-console data-lang=console>$ vault read auth/kubernetes/role/vault-policy-controller
Key                                 Value
---                                 -----
bound_service_account_names         [vault]
bound_service_account_namespaces    [demo]
token_bound_cidrs                   []
token_explicit_max_ttl              0s
token_max_ttl                       24h
token_no_default_policy             false
token_num_uses                      0
token_period                        24h
token_policies                      [default vault-policy-controller]
token_ttl                           24h
token_type                          default
</code></pre><p>Now, we will update the Vault policy <code>vault-policy-controller</code> and add the permissions for <code>pki/*</code> path with existing permissions.</p><p><code>pki-policy.hcl:</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>
<span style=color:#ae81ff>path &#34;pki/*&#34; {</span>
    <span style=color:#ae81ff>capabilities = [&#34;read&#34;, &#34;create&#34;, &#34;update&#34;, &#34;delete&#34;]</span>
}
</code></pre></div><p>Update the <code>vault-policy-controller</code> policy:</p><pre><code class=language-console data-lang=console># write existing polices to a file
$ vault policy read vault-policy-controller &gt; examples/guides/secret-engines/pki/policy.hcl

# append the pki-policy at the end of the existing policies
$ cat examples/guides/secret-engines/pki/pki-policy.hcl &gt;&gt; examples/guides/secret-engines/pki/policy.hcl

# write the update policy to Vault
$ vault policy write vault-policy-controller examples/guides/secret-engines/pki/policy.hcl
Success! Uploaded policy: vault-policy-controller

# read updated policy
$ vault policy read vault-policy-controller
... ...
... ...
path &quot;pki/*&quot; {
    capabilities = [&quot;read&quot;, &quot;create&quot;, &quot;update&quot;, &quot;delete&quot;]
}
</code></pre><p>So, we have updated the policy successfully and ready to mount the secrets into Kubernetes pods.</p><h2 id=mount-certificates-into-a-kubernetes-pod>Mount Certificates into a Kubernetes Pod</h2><p>Since Kubernetes 1.14, <code>storage.k8s.io/v1beta1</code> <code>CSINode</code> and <code>CSIDriver</code> objects were introduced. Let&rsquo;s check <a href=https://kubernetes-csi.github.io/docs/csi-driver-object.html>CSIDriver</a> and <a href=https://kubernetes-csi.github.io/docs/csi-node-object.html>CSINode</a> are available or not.</p><pre><code class=language-console data-lang=console>$ kubectl get csidrivers
NAME                        CREATED AT
secrets.csi.kubevault.com   2019-12-09T04:32:50Z

$ kubectl get csinodes
NAME             CREATED AT
2gb-pool-57jj7   2019-12-09T04:32:52Z
2gb-pool-jrvtj   2019-12-09T04:32:58Z
</code></pre><p>So, we can create <code>StorageClass</code> now.</p><h3 id=create-storageclass>Create StorageClass</h3><p>Create <code>StorageClass</code> object with the following content:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StorageClass</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>storage.k8s.io/v1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vault-pki-storage</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>storageclass.kubernetes.io/is-default-class</span>: <span style=color:#e6db74>&#34;false&#34;</span>
<span style=color:#f92672>provisioner</span>: <span style=color:#ae81ff>secrets.csi.kubevault.com</span>
<span style=color:#f92672>parameters</span>:
  <span style=color:#f92672>ref</span>: <span style=color:#ae81ff>demo/vault</span> <span style=color:#75715e># namespace/AppBinding, we created during vault configuration</span>
  <span style=color:#f92672>engine</span>: <span style=color:#ae81ff>PKI</span> <span style=color:#75715e># vault engine name</span>
  <span style=color:#f92672>role</span>: <span style=color:#ae81ff>example-dot-com</span> <span style=color:#75715e># role name created</span>
  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>pki</span> <span style=color:#75715e># specifies the secret engine path, default is gcp</span>
  <span style=color:#f92672>common_name</span>: <span style=color:#ae81ff>www.my-website.com</span> <span style=color:#75715e># specifies the requested CN for the certificate</span>
</code></pre></div><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/storageClass.yaml
storageclass.storage.k8s.io/vault-pki-storage created
</code></pre><p>Here, you can also pass the following parameters optionally to issue the certificate</p><ul><li><p><code>common_name</code> (string: <required>) – Specifies the requested CN for the certificate. If the CN is allowed by role policy, it will be issued.</p></li><li><p><code>alt_names</code> (string: &ldquo;") – Specifies requested Subject Alternative Names, in a comma-delimited list. These can be host names or email addresses; they will be parsed into their respective fields. If any requested names do not match role policy, the entire request will be denied.</p></li><li><p><code>ip_sans</code> (string: &ldquo;") – Specifies requested IP Subject Alternative Names, in a comma-delimited list. Only valid if the role allows IP SANs (which is the default).</p></li><li><p><code>uri_sans</code> (string: &ldquo;") – Specifies the requested URI Subject Alternative Names, in a comma-delimited list.</p></li><li><p><code>other_sans</code> (string: &ldquo;") – Specifies custom OID/UTF8-string SANs. These must match values specified on the role in allowed_other_sans (globbing allowed). The format is the same as OpenSSL: <oid>;<type>:<value> where the only current valid type is UTF8. This can be a comma-delimited list or a JSON string slice.</p></li><li><p><code>ttl</code> (string: &ldquo;") – Specifies requested Time To Live. Cannot be greater than the role&rsquo;s max_ttl value. If not provided, the role&rsquo;s ttl value will be used. Note that the role values default to system values if not explicitly set.</p></li><li><p><code>format</code> (string: &ldquo;") – Specifies the format for returned data. Can be pem, der, or pem_bundle; defaults to pem. If der, the output is base64 encoded. If pem_bundle, the certificate field will contain the private key and certificate, concatenated; if the issuing CA is not a Vault-derived self-signed root, this will be included as well.</p></li><li><p><code>private_key_format</code> (string: &ldquo;") – Specifies the format for marshaling the private key. Defaults to der which will return either base64-encoded DER or PEM-encoded DER, depending on the value of format. The other option is pkcs8 which will return the key marshalled as PEM-encoded PKCS8.</p></li><li><p><code>exclude_cn_from_sans</code> (bool: false) – If true, the given common_name will not be included in DNS or Email Subject Alternate Names (as appropriate). Useful if the CN is not a hostname or email address, but is instead some human-readable identifier.</p></li></ul><h2 id=test--verify>Test & Verify</h2><p>Let&rsquo;s create a separate namespace called <code>trial</code> for testing purpose.</p><pre><code class=language-console data-lang=console>$ kubectl create ns trail
namespace/trail created
</code></pre><h3 id=create-pvc>Create PVC</h3><p>Create a <code>PersistentVolumeClaim</code> with the following data. This makes sure a volume will be created and provisioned on your behalf.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>csi-pvc-pki</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trial</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>accessModes</span>:
    - <span style=color:#ae81ff>ReadWriteOnce</span>
  <span style=color:#f92672>resources</span>:
    <span style=color:#f92672>requests</span>:
      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>100Mi</span>
  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>vault-pki-storage</span>
</code></pre></div><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/pvc.yaml
persistentvolumeclaim/csi-pvc-pki created
</code></pre><h3 id=create-vaultpolicy-and-vaultpolicybinding-for-pods-service-account>Create VaultPolicy and VaultPolicyBinding for Pod&rsquo;s Service Account</h3><p>Let&rsquo;s say pod&rsquo;s service account name is <code>pod-sa</code> located in <code>trial</code> namespace. We need to create a <a href=/docs/v2020.07.09-beta.0/concepts/policy-crds/vaultpolicy>VaultPolicy</a> and a <a href=/docs/v2020.07.09-beta.0/concepts/policy-crds/vaultpolicybinding>VaultPolicyBinding</a> so that the pod has access to read secrets from the Vault server.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policy.kubevault.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VaultPolicy</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pki-se-policy</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>vaultRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vault</span>
  <span style=color:#75715e># Here, pki secret engine is enabled at &#34;pki&#34;.</span>
  <span style=color:#75715e># If the path was &#34;demo-se&#34;, policy should be like</span>
  <span style=color:#75715e># path &#34;demo-se/*&#34; {}.</span>
  <span style=color:#f92672>policyDocument</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>    path &#34;pki/*&#34; {
</span><span style=color:#e6db74>      capabilities = [&#34;create&#34;, &#34;read&#34;]
</span><span style=color:#e6db74>    }</span>    
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policy.kubevault.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VaultPolicyBinding</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pki-se-role</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>vaultRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vault</span>
  <span style=color:#f92672>policies</span>:
  - <span style=color:#f92672>ref</span>: <span style=color:#ae81ff>pki-se-policy</span>
  <span style=color:#f92672>subjectRef</span>:
    <span style=color:#f92672>kubernetes</span>:
      <span style=color:#f92672>serviceAccountNames</span>:
      - <span style=color:#e6db74>&#34;pod-sa&#34;</span>
      <span style=color:#f92672>serviceAccountNamespaces</span>:
      - <span style=color:#e6db74>&#34;trial&#34;</span>
</code></pre></div><p>Let&rsquo;s create VaultPolicy and VaultPolicyBinding:</p><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/vaultPolicy.yaml
vaultpolicy.policy.kubevault.com/pki-se-policy created

$ kubectl apply -f docs/examples/guides/secret-engines/pki/vaultPolicyBinding.yaml
vaultpolicybinding.policy.kubevault.com/pki-se-role created
</code></pre><p>Check if the VaultPolicy and the VaultPolicyBinding are successfully registered to the Vault server:</p><pre><code class=language-console data-lang=console>$ kubectl get vaultpolicy -n demo
NAME                           STATUS    AGE
pki-se-policy                  Success   8s

$ kubectl get vaultpolicybinding -n demo
NAME                           STATUS    AGE
pki-se-role                    Success   10s
</code></pre><h3 id=create-service-account-for-pod>Create Service Account for Pod</h3><p>Let&rsquo;s create the service account <code>pod-sa</code> which was used in VaultPolicyBinding. When a VaultPolicyBinding object is created, the KubeVault operator create an auth role in the Vault server. The role name is generated by the following naming format: <code>k8s.(clusterName or -).namespace.name</code>. Here, it is <code>k8s.-.demo.pki-se-role</code>. We need to provide the auth role name as service account <code>annotations</code> while creating the service account. If the annotation <code>secrets.csi.kubevault.com/vault-role</code> is not provided, the CSI driver will not be able to perform authentication to the Vault.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-sa</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trial</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>secrets.csi.kubevault.com/vault-role</span>: <span style=color:#ae81ff>k8s.-.demo.pki-se-role</span>
</code></pre></div><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/podServiceAccount.yaml
serviceaccount/pod-sa created
</code></pre><h3 id=create-pod>Create Pod</h3><p>Now we can create a Pod which refers to this volume. When the Pod is created, the volume will be attached, formatted and mounted to the specific container.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mypod</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trial</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mypod</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
      <span style=color:#f92672>command</span>:
        - <span style=color:#ae81ff>sleep</span>
        - <span style=color:#e6db74>&#34;3600&#34;</span>
      <span style=color:#f92672>volumeMounts</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-vault-volume</span>
          <span style=color:#f92672>mountPath</span>: <span style=color:#e6db74>&#34;/etc/pki&#34;</span>
          <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>pod-sa</span> <span style=color:#75715e># service account that was created</span>
  <span style=color:#f92672>volumes</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-vault-volume</span>
      <span style=color:#f92672>persistentVolumeClaim</span>:
        <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>csi-pvc-pki</span>
</code></pre></div><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/pod.yaml
pod/mypod created
</code></pre><p>Check if the Pod is running successfully, by running:</p><pre><code class=language-console data-lang=console>$ kubectl get pods -n trial
NAME                    READY   STATUS    RESTARTS   AGE
mypod                   1/1     Running   0          11s
</code></pre><h3 id=verify-secret>Verify Secret</h3><p>If the Pod is running successfully, then check inside the app container by running</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n trial  mypod sh
/ # ls /etc/pki/
certificate       issuing_ca        private_key_type
expiration        private_key       serial_number

/ # cat /etc/pki/certificate
-----BEGIN CERTIFICATE-----
MIIDVjCCAj6gAwIBAgIUNjTBC3qR7Zaj0XrzUc3QEbE+EhgwDQYJKoZIhvcNAQEL
BQAwGTEXMBUGA1UEAxMObXktd2Vic2l0ZS5jb20wHhcNMTkxMjEzMTExNDIwWhcN
..... .... .... .... .... .... .... .... .... .... .... .... ...
bo901cITjNyCTbAF2401pYFZ4rSlxhcuAvc7c27uqvKEh2/ctMGRkvPVygbPdvB8
LfCskfX0sk8PQiEznlmYlChK3KNsEp+xSCyjU+pDEw8AcDXwE6vVFft/fRX0oiHH
KIzTZ7R/QKUkLisloMUHStINISAehglLZTJjo79jB7GN66wyqP+E8iRLEYFAAsb0
aZ5wuSTYEpqOuP6G1tOdhiE7iptFu9Wg9dKtmXkZnc0iTBL60xMUUapH
-----END CERTIFICATE-----
</code></pre><h2 id=cleaning-up>Cleaning up</h2><p>To clean up the Kubernetes resources created by this tutorial, run:</p><pre><code class=language-console data-lang=console>$ kubectl delete ns demo
namespace &quot;demo&quot; deleted

$ kubectl delete ns trial
namespace &quot;trial&quot; deleted
</code></pre></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#vault-server>Vault Server</a></li><li><a href=#enable-and-configure-pki-secret-engine>Enable and Configure PKI Secret Engine</a><ul><li><a href=#enable-pki-secret-engine>Enable PKI Secret Engine</a></li><li><a href=#configure-ca-certificate-and-private-key>Configure CA Certificate and Private Key</a></li><li><a href=#configure-a-pki-role>Configure a PKI Role</a></li></ul></li><li><a href=#update-vault-policy>Update Vault Policy</a></li><li><a href=#mount-certificates-into-a-kubernetes-pod>Mount Certificates into a Kubernetes Pod</a><ul><li><a href=#create-storageclass>Create StorageClass</a></li></ul></li><li><a href=#test--verify>Test & Verify</a><ul><li><a href=#create-pvc>Create PVC</a></li><li><a href=#create-vaultpolicy-and-vaultpolicybinding-for-pods-service-account>Create VaultPolicy and VaultPolicyBinding for Pod&rsquo;s Service Account</a></li><li><a href=#create-service-account-for-pod>Create Service Account for Pod</a></li><li><a href=#create-pod>Create Pod</a></li><li><a href=#verify-secret>Verify Secret</a></li></ul></li><li><a href=#cleaning-up>Cleaning up</a></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown"),kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active")})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><div class=improve-section-area><div class="container section"><div class=improve-bg-color><div class=columns><div class="column is-6"><a href=https://github.com/kubevault/docs/edit/master/docs/guides/secret-engines/pki/csi-driver.md/>Improve This Page</a></div></div></div></div></div><script type=text/javascript>var pageSize=5,acSearch=document.querySelector("#acSearch"),bodyOverlay=document.querySelector(".overlay-bg"),sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block",sidebarSearch.style.right="0",document.getElementById("searchbox").focus(),bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none",sidebarSearch.style.right="-80%"})});function encodeQueryData(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+'='+encodeURIComponent(a[c]));return b.join('&')}document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(a){a.preventDefault(),a.keyCode===13&&queryPage(1)});function queryPage(c){var i=document.getElementById("searchbox").value,j="015199383701854252104:nhc3zij9nui",d="AIzaSyBrcwLTnL09geNrFMUx1kpL--dT1379aag",f="small",g="renderResult",h="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:i,cx:j,key:d,imgSize:f,callback:g,start:(c-1)*pageSize+1,num:pageSize}),a=document.createElement("script"),b;a.src=h,e=document.getElementById("searchbar-script-container"),b=e.lastElementChild,b&&e.removeChild(b),e.appendChild(a)}function renderSearchResultEntry(a){var b='<div class="single-search-result"><h3><a href="'+a.link+'">'+a.title+'</a></h3>'+'<a href="'+a.link+'">'+a.htmlFormattedUrl+'</a>'+'<div class="result-description-wrapper">';return a.pagemap&&a.pagemap.cse_thumbnail&&(b+='<div class="result-thumb"><img src="'+a.pagemap.cse_thumbnail[0].src+'" alt="" />'+'</div>'),b+='<div class="result-description"><p>'+a.snippet+'</p>'+'</div>'+'</div>'+'</div>',b}function renderResult(a){var e,d,c,b;if(document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left"><p>About <span class="search-count">'+a.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+a.searchInformation.formattedSearchTime+' </span>seconds)'+'</p>'+'</div>',!a.items)return;e=document.querySelector(".search-result-wrapper"),e.innerHTML="";for(d=0;d<a.items.length;d++)e.innerHTML+=renderSearchResultEntry(a.items[d]);c='<ul>',a.queries.previousPage&&(b=Math.floor(a.queries.previousPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Previous</a></li>'),a.queries.request&&(b=Math.floor(a.queries.request[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')" class="is-active">'+b+'</a></li>'),a.queries.nextPage&&(b=Math.floor(a.queries.nextPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Next</a></li>'),c+='</ul>',document.querySelector(".pagination-area .pagination-list").innerHTML=c}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class="columns is-mobile is-multiline"><div class="column is-full-mobile is-one-third-desktop is-one-third-widescreen is-one-third-tablet" data-aos=fade-up><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form method=post action=https://listmonk.appscode.com/subscription/form id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input type=hidden id=afbbc name=l value=afbbc974-e163-4467-be49-040e399520f3>
<input class=input name=email id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:+1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>+1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=500><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://stash.run>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://kubeform.cloud>Kubeform</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=600><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Pricing</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=700><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=800><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>© 2021 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script src=https://unpkg.com/downloadjs@1.4.7/download.min.js></script><script src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><script src=/assets/js/main.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/9255943.js></script><script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date;(function(){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0,a.src='https://embed.tawk.to/5821e34b18d9f16af02864b7/default',a.charset='UTF-8',a.setAttribute('crossorigin','*'),b.parentNode.insertBefore(a,b)})()</script></body></html>