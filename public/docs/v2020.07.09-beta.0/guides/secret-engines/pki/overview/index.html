<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-62096468-4','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#326CE5"><title>KubeVault by AppsCode</title><meta name=description content="Tools for running HashiCorp Vault on Kubernetes"><meta name=author content="AppsCode Inc."><meta name=keywords content="kubernetes appscode vault secret csi security"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/kubevault/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/kubevault/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/kubevault/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/kubevault/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/kubevault/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/kubevault/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/kubevault/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/kubevault/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/kubevault/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/kubevault/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/kubevault/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/kubevault/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/kubevault/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/kubevault/icons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/images/products/kubevault/icons/ms-icon-144x144.png"><meta itemprop=name content="KubeVault by AppsCode"><meta itemprop=description content="Tools for running HashiCorp Vault on Kubernetes"><meta itemprop=image content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@kubevault"><meta name=twitter:title content="KubeVault by AppsCode"><meta name=twitter:creator content="@kubevault"><meta name=twitter:description content="Tools for running HashiCorp Vault on Kubernetes"><meta name=twitter:image:src content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta property="og:url" content="https://kubevault.com"><meta property="og:title" content="KubeVault by AppsCode"><meta property="og:description" content="Tools for running HashiCorp Vault on Kubernetes"><meta property="og:site_name" content="KubeVault by AppsCode"><meta property="og:image" content="https://kubevault.com/assets/images/products/kubevault/kubevault-1280x640.png"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/css/font-awesome.min.css><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=/assets/sass/main.min.8b1cf6186f0e12d4a91cc7f6ccc7db154302adadcdfef7fddaa3512566b5b3ae.css></head><body class=kubevault><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade Databases on Kubernetes</p></div></a><a href=https://stash.run class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://kubeform.cloud class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs & Terraform</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Open Source</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://voyagermesh.com class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://pharmer.cloud class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm & Cluster API</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://kubevault.com><img src=/assets/images/products/kubevault/kubevault-white.png alt=KubeVault></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/pricing/ class=navbar-item>Pricing</a>
<a href=/docs/v0.3.0/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/kubevault class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeVault class=navbar-item>Twitter</a>
<a href=https://slack.appscode.com class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=stars&query=%24.stars&url=https://github-stars.appscode.workers.dev/user/kubevault">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="GitHub Forks" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=forks&query=%24.forks&url=https://github-stars.appscode.workers.dev/user/kubevault">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/kubevault/vault-operator?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker&label=pulls"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/docs/v2020.07.09-beta.0/ class=navbar-item>Welcome</a>
<a href=/docs/v2020.07.09-beta.0/concepts/ class=navbar-item>Concepts</a>
<a href=/docs/v2020.07.09-beta.0/setup/ class=navbar-item>Setup</a>
<a href=/docs/v2020.07.09-beta.0/guides/ class="is-active navbar-item">Guides</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Reference</a><div class=ac-dropdown><a href=/docs/v2020.07.09-beta.0/reference/operator/ class=navbar-item>Vault Operator</a>
<a href=/docs/v2020.07.09-beta.0/reference/csi-driver/ class=navbar-item>Vault CSI Driver</a>
<a href=/docs/v2020.07.09-beta.0/reference/cli/ class=navbar-item>KubeVault CLI</a>
<a href=/docs/v2020.07.09-beta.0/reference/unsealer/ class=navbar-item>Vault Unsealer</a></div></div></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><article class="message is-danger"><div class=message-body>You are looking at the documentation of a prior release. To read the documentation of the latest release, please visit <a href=/docs/v0.3.0/guides/secret-engines/pki/overview/>here</a>.</div></article><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v0.3.0/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/kubevault/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v0.3.0/ class=dropdown-item>v0.3.0<div class=tag>Latest</div></a><a href=/docs/0.2.0/ class=dropdown-item>0.2.0</a>
<a href=/docs/0.1.0/ class=dropdown-item>0.1.0</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-1>
<label for=e3aeeebf13958691271045fd08f29278-1><a href=/docs/v2020.07.09-beta.0/guides/>Guides</a></label></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-2>
<label for=e3aeeebf13958691271045fd08f29278-2><a>Vault Server</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server/>Vault Server</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/external-vault-sever/>External Vault Server</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-3>
<label for=e3aeeebf13958691271045fd08f29278-3><a>Policy Management</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/policy-management/overview/>Overview</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-4 checked>
<label for=e3aeeebf13958691271045fd08f29278-4><a>Secret Engines</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-5>
<label for=e3aeeebf13958691271045fd08f29278-5><a>AWS</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/aws/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/aws/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-6>
<label for=e3aeeebf13958691271045fd08f29278-6><a>Azure</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/azure/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/azure/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-7>
<label for=e3aeeebf13958691271045fd08f29278-7><a>GCP</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/gcp/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/gcp/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-8>
<label for=e3aeeebf13958691271045fd08f29278-8><a>Key/Value</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/kv/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/kv/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-9>
<label for=e3aeeebf13958691271045fd08f29278-9><a>MongoDB</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mongodb/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mongodb/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-10>
<label for=e3aeeebf13958691271045fd08f29278-10><a>MySQL</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mysql/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/mysql/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-11 checked>
<label for=e3aeeebf13958691271045fd08f29278-11><a>PKI</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li class=is-active><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/pki/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/pki/csi-driver/>CSI Driver</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-12>
<label for=e3aeeebf13958691271045fd08f29278-12><a>PostgreSQL</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/postgres/overview/>Overview</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/secret-engines/postgres/csi-driver/>CSI Driver</a></li></ul></div></div></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-13>
<label for=e3aeeebf13958691271045fd08f29278-13><a>Monitoring</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/overview/>Overview</a></li><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-14>
<label for=e3aeeebf13958691271045fd08f29278-14><a>Vault Server</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/builtin/>Builtin Prometheus</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/coreos/>Prometheus Operator</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-server/grafana/>Grafana Dashboard</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-15>
<label for=e3aeeebf13958691271045fd08f29278-15><a>CSI Driver</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/csi-driver/builtin/>Builtin Prometheus</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/csi-driver/coreos/>Prometheus Operator</a></li></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-16>
<label for=e3aeeebf13958691271045fd08f29278-16><a>KubeVault operator</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-operator/coreos/>Prometheus Operator</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/monitoring/vault-operator/builtin/>Builtin Prometheus</a></li></ul></div></div></ul></div></div><div class=item><input type=checkbox id=e3aeeebf13958691271045fd08f29278-17>
<label for=e3aeeebf13958691271045fd08f29278-17><a>Platforms</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/eks/>EKS</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/aks/>AKS</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/gke/>GKE</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/external-vault/>External Vault</a></li><li><a href=/docs/v2020.07.09-beta.0/guides/platforms/multi-cluster-vault/>Multi-Cluster</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><blockquote><p>New to KubeVault? Please start <a href=/docs/v2020.07.09-beta.0/concepts/README>here</a>.</p></blockquote><h1 id=manage-pkicertificates-secrets-using-the-kubevault-operator>Manage PKI(certificates) secrets using the KubeVault operator</h1><p>The <a href=https://www.vaultproject.io/docs/secrets/pki/index.html>PKI secrets engine</a> generates dynamic X.509 certificates. With this secrets engine, services can get certificates without going through the usual manual process of generating a private key and CSR, submitting to a CA, and waiting for a verification and signing process to complete. Vault&rsquo;s built-in authentication and authorization mechanisms provide the verification functionality.</p><p>You can easily manage <a href=https://www.vaultproject.io/docs/secrets/pki/index.html>PKI secret engine</a> using the KubeVault operator.</p><p>You should be familiar with the following CRD:</p><ul><li><a href=/docs/v2020.07.09-beta.0/concepts/policy-crds/vaultpolicy>VaultPolicy</a></li><li><a href=/docs/v2020.07.09-beta.0/concepts/policy-crds/vaultpolicybinding>VaultPolicyBinding</a></li><li><a href=/docs/v2020.07.09-beta.0/concepts/vault-server-crds/auth-methods/appbinding>AppBinding</a></li></ul><h2 id=before-you-begin>Before you begin</h2><ul><li>Install KubeVault operator in your cluster from <a href=/docs/v2020.07.09-beta.0/setup/operator/install>here</a>.</li></ul><p>To keep things isolated, we are going to use a separate namespace called <code>demo</code> throughout this tutorial.</p><pre><code class=language-console data-lang=console>$ kubectl create ns demo
namespace/demo created
</code></pre><p>In this tutorial, we are going to demonstrate the use of the PKI secret engine.</p><h2 id=vault-server>Vault Server</h2><p>If you don&rsquo;t have a Vault Server, you can deploy it by using the KubeVault operator.</p><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server>Deploy Vault Server</a></li></ul><p>The KubeVault operator can manage policies and secret engines of Vault servers which are not provisioned by the KubeVault operator. You need to configure both the Vault server and the cluster so that the KubeVault operator can communicate with your Vault server.</p><ul><li><a href=/docs/v2020.07.09-beta.0/guides/vault-server/external-vault-sever#configuration>Configure cluster and Vault server</a></li></ul><p>Now, we have the <a href=/docs/v2020.07.09-beta.0/concepts/vault-server-crds/auth-methods/appbinding>AppBinding</a> that contains connection and authentication information about the Vault server.</p><pre><code class=language-console data-lang=console>$ kubectl get appbinding -n demo
NAME    AGE
vault   50m

$ kubectl get appbinding -n demo vault -o yaml
apiVersion: appcatalog.appscode.com/v1alpha1
kind: AppBinding
metadata:
  name: vault
  namespace: demo
spec:
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN1RENDQWFDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFOTVFzd0NRWURWUVFERXdKallUQWUKRncweE9URXhNVEl3T1RFMU5EQmFGdzB5T1RFeE1Ea3dPVEUxTkRCYU1BMHhDekFKQmdOVkJBTVRBbU5oTUlJQgpJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdFZFZmtic2c2T085dnM2d1Z6bTlPQ1FYClBtYzBYTjlCWjNMbXZRTG0zdzZGaWF2aUlSS3VDVk1hN1NRSGo2L2YvOHZPeWhqNEpMcHhCM0hCYVFPZ3RrM2QKeEFDbHppU1lEd3dDbGEwSThxdklGVENLWndreXQzdHVQb0xybkppRFdTS2xJait6aFZDTHZ0enB4MDE3SEZadApmZEdhUUtlSXREUVdyNUV1QWlCMjhhSVF4WXREaVN6Y0h3OUdEMnkrblRMUEd4UXlxUlhua0d1UlIvR1B3R3lLClJ5cTQ5NmpFTmFjOE8wVERYRkIydWJQSFNza2xOU1VwSUN3S1IvR3BobnhGak1rWm4yRGJFZW9GWDE5UnhzUmcKSW94TFBhWDkrRVZxZU5jMlczN2MwQlhBSGwyMHVJUWQrVytIWDhnOVBVVXRVZW9uYnlHMDMvampvNERJRHdJRApBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lHCjl3MEJBUXNGQUFPQ0FRRUFabHRFN0M3a3ZCeTNzeldHY0J0SkpBTHZXY3ZFeUdxYUdCYmFUbGlVbWJHTW9QWXoKbnVqMUVrY1I1Qlg2YnkxZk15M0ZtZkJXL2E0NU9HcDU3U0RMWTVuc2w0S1RlUDdGZkFYZFBNZGxrV0lQZGpnNAptOVlyOUxnTThkOGVrWUJmN0paUkNzcEorYkpDU1A2a2p1V3l6MUtlYzBOdCtIU0psaTF3dXIrMWVyMUprRUdWClBQMzFoeTQ2RTJKeFlvbnRQc0d5akxlQ1NhTlk0UWdWK3ZneWJmSlFEMVYxbDZ4UlVlMzk2YkJ3aS94VGkzN0oKNWxTVklmb1kxcUlBaGJPbjBUWHp2YzBRRXBKUExaRDM2VDBZcEtJSVhjZUVGYXNxZzVWb1pINGx1Uk50SStBUAp0blg4S1JZU0xGOWlCNEJXd0N0aGFhZzZFZVFqYWpQNWlxZnZoUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    service:
      name: vault
      port: 8200
      scheme: HTTPS
  parameters:
    apiVersion: config.kubevault.com/v1alpha1
    kind: VaultServerConfiguration
    path: kubernetes
    vaultRole: vault-policy-controller
    kubernetes:
      serviceAccountName: vault
      tokenReviewerServiceAccountName: vault-k8s-token-reviewer
      usePodServiceAccountForCSIDriver: true
</code></pre><h2 id=use-pki-secret-engine-as-root-user>Use PKI Secret Engine as Root User</h2><p>Here, we are going to use the Vault root token to perform authentication to the Vault server. We will use the <a href=https://www.vaultproject.io/docs/commands/#vault-commands-cli->Vault CLI</a> throughout the tutorial.</p><blockquote><p>Don&rsquo;t have Vault CLI? Download and configure it as described <a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server#enable-vault-cli>here</a></p></blockquote><p>Export the root token as environment variable:</p><pre><code class=language-console data-lang=console>export VAULT_TOKEN=s.diWLjSzmfSmF0qUNYV3qOIeX
</code></pre><p>Enable the PKI secrets engine:</p><pre><code class=language-console data-lang=console>$ vault secrets enable pki
Success! Enabled the pki secrets engine at: pki/
</code></pre><p>Increase the TTL by tuning the secrets engine. The default value of 30 days may be too short, so increase it to 1 year:</p><pre><code class=language-console data-lang=console>$ vault secrets tune -max-lease-ttl=8760h pki
Success! Tuned the secrets engine at: pki/
</code></pre><p>Configure a CA certificate and private key:</p><pre><code class=language-console data-lang=console>$ vault write pki/root/generate/internal \
                          common_name=my-website.com \
                          ttl=8760h
Key              Value
---              -----
certificate      -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
expiration       1606200496
issuing_ca       -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
serial_number    10:39:a7:02:60:b4:b2:22:12:96:b7:b3:0f:7f:c2:79:45:d3:49:fb
</code></pre><p>Configure a role that maps a name in Vault to a procedure for generating a certificate. When users or machines generate credentials, they are generated against this role:</p><pre><code class=language-console data-lang=console>$ vault write pki/roles/example-dot-com \
                          allowed_domains=my-website.com \
                          allow_subdomains=true \
                          max_ttl=72h
Success! Data written to: pki/roles/example-dot-com
</code></pre><p>Generate a new credential by writing to the /issue endpoint with the name of the role:</p><pre><code class=language-console data-lang=console>$ vault write pki/issue/example-dot-com \
                        common_name=www.my-website.com
Key                 Value
---                 -----
certificate         -----BEGIN CERTIFICATE-----
MIIDVjCCAj6gAwIBAgIUWQhPLW6R/nk/3x3XReHC1Ze4BWUwDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
TSuguIiSBt5NN0ou4aY01FbeJJOHZhtpj31XdXOCAKR40lPCmWtEUAbcuEhLlkm+
vmhNYxBqkx33jEIMxk95P4eKIYPyr45/8o7bV1jq7G26aBzj1Mjd0JmU
-----END CERTIFICATE-----
expiration          1574924103
issuing_ca          -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
private_key         -----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAuK7V4GuoHSF8pnlr4hApeU7V3zpuQ2rWt3pXgi9TPBCmIuye
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
+o8HetGW5xWvuQ/ObkiSzdQ8nxMyiQj/whe4riYriOw1fYwPrjZfxTm1jsyEmbbm
gYewhfHP3hOgTCVu3SjhvOXS3pnW7hUP4wtvpLLdRumEUM/fK7pwNg==
-----END RSA PRIVATE KEY-----
private_key_type    rsa
serial_number       59:008:4f:2d:6e:91:fe:79:3f:df:1d:d7:45:e1:c2:d5:97:b8:05:65
</code></pre><p>For more details visit the <a href=https://www.vaultproject.io/docs/secrets/pki/index.html#setup>official Vault documentation</a>.</p><h2 id=use-pki-secret-engine-as-non-root-user>Use PKI Secret Engine as Non-root User</h2><p>Here, we are going to create a Kubernetes service account and give it limited access (i.e only PKI secret engine) from the Vault using the VaultPolicy and the VaultPolicyBinding.</p><h3 id=create-kubernetes-service-account>Create Kubernetes Service Account</h3><p>Create a service account <code>pki-admin</code> to the <code>demo</code> namespace:</p><pre><code class=language-console data-lang=console>$  kubectl create serviceaccount -n demo pki-admin
serviceaccount/pki-admin created

# get service account JWT token which will be required while performing
# login operation to the Vault
$ kubectl get secrets -n demo pki-admin-token-26kwb  -o jsonpath=&quot;{.data.token}&quot; | base64 --decode;
eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZW1vIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InBraS1hZG1pbi10b2tlbi0yNmt3YiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJwa2ktYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkYmVkZDQ2Ni0yYzc0LTQ0OGItOTBlZS01MDlkNGI4MTJjOTEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVtbzpwa2ktYWRtaW4ifQ.ce7OqA05nsfBMRsEOiG1Lje_mOBdUZRKALB9Sc9LVqjKIJZHdxvZ7NT4ZKrIyPEe02aItzxlXLAP4Fa8dUMshZuNyuxBYN7p2qHRCwVKHqOuz8LdRQWypKiLozL9v0DHk-vbFWFcm0eye57vJBFtriYyYRUA84WZhxRb9wz-f8z7PSmO2mpjkrICt7wi48j-4FObdhFWk6HAKXFD7bCzL4j3CWUcx2wTIsnOEz9SifjYZuGaog6tpWhnj-guEKpXJzBLAoMBU0Vr3U7Zv_z1qvKFF4ZherUBxSOMo27lL2xbhkpbW2wf_DCAjLx8pScoh9mxv7AK2WJCHeA0JRzrug
</code></pre><h3 id=create-vaultpolicy-and-vaultpolicybinding>Create VaultPolicy and VaultPolicyBinding</h3><p>A sample VaultPolicy object with necessary path permission for the PKI secret engine:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policy.kubevault.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VaultPolicy</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pki-policy</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>vaultRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vault</span>
  <span style=color:#f92672>policyDocument</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>    path &#34;sys/mounts&#34; {
</span><span style=color:#e6db74>      capabilities = [&#34;read&#34;, &#34;list&#34;]
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    path &#34;sys/mounts/*&#34; {
</span><span style=color:#e6db74>      capabilities = [&#34;create&#34;, &#34;read&#34;, &#34;update&#34;, &#34;delete&#34;]
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    path &#34;pki/*&#34; {
</span><span style=color:#e6db74>        capabilities = [&#34;read&#34;,&#34;create&#34;, &#34;list&#34;, &#34;update&#34;, &#34;delete&#34;]
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    path &#34;sys/leases/revoke/*&#34; {
</span><span style=color:#e6db74>        capabilities = [&#34;update&#34;]
</span><span style=color:#e6db74>    }</span>    
</code></pre></div><p>Create VaultPolicy and check status:</p><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/policy.yaml
vaultpolicy.policy.kubevault.com/pki-policy created

$ kubectl get vaultpolicy -n demo
NAME                           STATUS    AGE
pki-policy                     Success   3m15s
</code></pre><p>A sample VaultPolicyBinding object that binds the <code>pki-policy</code> to the <code>pki-admin</code> service account:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policy.kubevault.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VaultPolicyBinding</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pki-admin-role</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>vaultRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vault</span>
  <span style=color:#f92672>policies</span>:
  - <span style=color:#f92672>ref</span>: <span style=color:#ae81ff>pki-policy</span>
  <span style=color:#f92672>subjectRef</span>:
    <span style=color:#f92672>kubernetes</span>:
      <span style=color:#f92672>serviceAccountNames</span>:
        - <span style=color:#e6db74>&#34;pki-admin&#34;</span>
      <span style=color:#f92672>serviceAccountNamespaces</span>:
        - <span style=color:#e6db74>&#34;demo&#34;</span>
      <span style=color:#f92672>ttl</span>: <span style=color:#e6db74>&#34;1000&#34;</span>
      <span style=color:#f92672>maxTTL</span>: <span style=color:#e6db74>&#34;2000&#34;</span>
      <span style=color:#f92672>period</span>: <span style=color:#e6db74>&#34;1000&#34;</span>
</code></pre></div><p>Create VaultPolicyBinding and check status:</p><pre><code class=language-console data-lang=console>$ kubectl apply -f docs/examples/guides/secret-engines/pki/policyBinding.yaml
vaultpolicybinding.policy.kubevault.com/pki-admin-role created

$ kubectl get vaultpolicybindings -n demo
NAME                           STATUS    AGE
pki-admin-role                 Success   43m
</code></pre><h3 id=login-vault-and-use-pki-secret-engine>Login Vault and Use PKI Secret Engine</h3><p>To resolve the naming conflict, name of the policy and role in Vault will follow this format: <code>k8s.{clusterName}.{metadata.namespace}.{metadata.name}</code>.</p><blockquote><p>Don&rsquo;t have Vault CLI? Download and configure it as described <a href=/docs/v2020.07.09-beta.0/guides/vault-server/vault-server#enable-vault-cli>here</a></p></blockquote><p>List Vault policies and Kubernetes auth roles:</p><pre><code class=language-console data-lang=console>$ vault list sys/policy
Keys
----
k8s.-.demo.pki-policy

$ vault read sys/policy/k8s.-.demo.pki-policy
Key      Value
---      -----
name     k8s.-.demo.pki-policy
rules    path &quot;sys/mounts&quot; {
  capabilities = [&quot;read&quot;, &quot;list&quot;]
}

path &quot;sys/mounts/*&quot; {
  capabilities = [&quot;create&quot;, &quot;read&quot;, &quot;update&quot;, &quot;delete&quot;]
}

path &quot;pki/*&quot; {
    capabilities = [&quot;read&quot;,&quot;create&quot;, &quot;list&quot;, &quot;update&quot;, &quot;delete&quot;]
}

path &quot;sys/leases/revoke/*&quot; {
    capabilities = [&quot;update&quot;]
}

$ vault list auth/kubernetes/role
Keys
----
k8s.-.demo.pki-admin-role

$ vault read auth/kubernetes/role/k8s.-.demo.pki-admin-role
Key                                 Value
---                                 -----
bound_service_account_names         [pki-admin]
bound_service_account_namespaces    [demo]
max_ttl                             33m20s
period                              16m40s
policies                            [k8s.-.demo.pki-policy]
token_bound_cidrs                   []
token_explicit_max_ttl              0s
token_max_ttl                       33m20s
token_no_default_policy             false
token_num_uses                      0
token_period                        16m40s
token_policies                      [k8s.-.demo.pki-policy]
token_ttl                           16m40s
token_type                          default
ttl                                 16m40s
</code></pre><p>So, we can see that the <code>pki-policy</code> is added to the <code>pki-admin-role</code>.</p><p>Now, login to the Vault using <code>pki-admin</code>&rsquo;s JWT token under <code>pki-admin-role</code> role.</p><pre><code class=language-console data-lang=console>$ vault write auth/kubernetes/login \
                       role=k8s.-.demo.pki-admin-role \
                       jwt=eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZW1vIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InBraS1hZG1pbi10b2tlbi0yNmt3YiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJwa2ktYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkYmVkZDQ2Ni0yYzc0LTQ0OGItOTBlZS01MDlkNGI4MTJjOTEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVtbzpwa2ktYWRtaW4ifQ.ce7OqA05nsfBMRsEOiG1Lje_mOBdUZRKALB9Sc9LVqjKIJZHdxvZ7NT4ZKrIyPEe02aItzxlXLAP4Fa8dUMshZuNyuxBYN7p2qHRCwVKHqOuz8LdRQWypKiLozL9v0DHk-vbFWFcm0eye57vJBFtriYyYRUA84WZhxRb9wz-f8z7PSmO2mpjkrICt7wi48j-4FObdhFWk6HAKXFD7bCzL4j3CWUcx2wTIsnOEz9SifjYZuGaog6tpWhnj-guEKpXJzBLAoMBU0Vr3U7Zv_z1qvKFF4ZherUBxSOMo27lL2xbhkpbW2wf_DCAjLx8pScoh9mxv7AK2WJCHeA0JRzrug

Key                                       Value
---                                       -----
token                                     s.ZPu4zcyaajjpxtS1t8fnh2LV
token_accessor                            5OknOf72h8WnP1v0I1C01626
token_duration                            16m40s
token_renewable                           true
token_policies                            [&quot;default&quot; &quot;k8s.-.demo.pki-policy&quot;]
identity_policies                         []
policies                                  [&quot;default&quot; &quot;k8s.-.demo.pki-policy&quot;]
token_meta_role                           k8s.-.demo.pki-admin-role
token_meta_service_account_name           pki-admin
token_meta_service_account_namespace      demo
token_meta_service_account_secret_name    pki-admin-token-26kwb
token_meta_service_account_uid            dbedd466-2c74-448b-90ee-509d4b812c91
</code></pre><p>Export the new Vault token as an environment variable:</p><pre><code class=language-console data-lang=console>export VAULT_TOKEN=s.ZPu4zcyaajjpxtS1t8fnh2LV
</code></pre><p>Now generate a new certificate using the PKI secret engine:</p><p>Enable the PKI secrets engine:</p><pre><code class=language-console data-lang=console>$ vault secrets enable pki
Success! Enabled the pki secrets engine at: pki/
</code></pre><p>Increase the TTL by tuning the secrets engine. The default value of 30 days may be too short, so increase it to 1 year:</p><pre><code class=language-console data-lang=console>$ vault secrets tune -max-lease-ttl=8760h pki
Success! Tuned the secrets engine at: pki/
</code></pre><p>Configure a CA certificate and private key:</p><pre><code class=language-console data-lang=console>$ vault write pki/root/generate/internal \
                          common_name=my-website.com \
                          ttl=8760h
Key              Value
---              -----
certificate      -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
expiration       1606200496
issuing_ca       -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
serial_number    10:39:a7:02:60:b4:b2:22:12:96:b7:b3:0f:7f:c2:79:45:d3:49:fb
</code></pre><p>Configure a role that maps a name in Vault to a procedure for generating a certificate. When users or machines generate credentials, they are generated against this role:</p><pre><code class=language-console data-lang=console>$ vault write pki/roles/example-dot-com \
                          allowed_domains=my-website.com \
                          allow_subdomains=true \
                          max_ttl=72h
Success! Data written to: pki/roles/example-dot-com
</code></pre><p>Generate a new credential by writing to the /issue endpoint with the name of the role:</p><pre><code class=language-console data-lang=console>$ vault write pki/issue/example-dot-com \
                        common_name=www.my-website.com
Key                 Value
---                 -----
certificate         -----BEGIN CERTIFICATE-----
MIIDVjCCAj6gAwIBAgIUWQhPLW6R/nk/3x3XReHC1Ze4BWUwDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
TSuguIiSBt5NN0ou4aY01FbeJJOHZhtpj31XdXOCAKR40lPCmWtEUAbcuEhLlkm+
vmhNYxBqkx33jEIMxk95P4eKIYPyr45/8o7bV1jq7G26aBzj1Mjd0JmU
-----END CERTIFICATE-----
expiration          1574924103
issuing_ca          -----BEGIN CERTIFICATE-----
MIIDPjCCAiagAwIBAgIUEDmnAmC0siISlrezD3/CeUXTSfswDQYJKoZIhvcNAQEL
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
CsFVu+vfMM9XEMYeKHRWAq9onJFyGuwKGhF0/7RbZ3EunTj6Zph+UMucGoL4xfXj
ITltdU1N4JPvihQq+8Omryay
-----END CERTIFICATE-----
private_key         -----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAuK7V4GuoHSF8pnlr4hApeU7V3zpuQ2rWt3pXgi9TPBCmIuye
... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ...
+o8HetGW5xWvuQ/ObkiSzdQ8nxMyiQj/whe4riYriOw1fYwPrjZfxTm1jsyEmbbm
gYewhfHP3hOgTCVu3SjhvOXS3pnW7hUP4wtvpLLdRumEUM/fK7pwNg==
-----END RSA PRIVATE KEY-----
private_key_type    rsa
serial_number       59:008:4f:2d:6e:91:fe:79:3f:df:1d:d7:45:e1:c2:d5:97:b8:05:65
</code></pre><p>For more details visit the <a href=https://www.vaultproject.io/docs/secrets/pki/index.html#setup>official Vault documentation</a>.</p></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a></li><li><a href=#vault-server>Vault Server</a></li><li><a href=#use-pki-secret-engine-as-root-user>Use PKI Secret Engine as Root User</a></li><li><a href=#use-pki-secret-engine-as-non-root-user>Use PKI Secret Engine as Non-root User</a><ul><li><a href=#create-kubernetes-service-account>Create Kubernetes Service Account</a></li><li><a href=#create-vaultpolicy-and-vaultpolicybinding>Create VaultPolicy and VaultPolicyBinding</a></li><li><a href=#login-vault-and-use-pki-secret-engine>Login Vault and Use PKI Secret Engine</a></li></ul></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown"),kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active")})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><div class=improve-section-area><div class="container section"><div class=improve-bg-color><div class=columns><div class="column is-6"><a href=https://github.com/kubevault/docs/edit/master/docs/guides/secret-engines/pki/overview.md/>Improve This Page</a></div></div></div></div></div><script type=text/javascript>var pageSize=5,acSearch=document.querySelector("#acSearch"),bodyOverlay=document.querySelector(".overlay-bg"),sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block",sidebarSearch.style.right="0",document.getElementById("searchbox").focus(),bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none",sidebarSearch.style.right="-80%"})});function encodeQueryData(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+'='+encodeURIComponent(a[c]));return b.join('&')}document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(a){a.preventDefault(),a.keyCode===13&&queryPage(1)});function queryPage(c){var i=document.getElementById("searchbox").value,j="015199383701854252104:nhc3zij9nui",d="AIzaSyBrcwLTnL09geNrFMUx1kpL--dT1379aag",f="small",g="renderResult",h="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:i,cx:j,key:d,imgSize:f,callback:g,start:(c-1)*pageSize+1,num:pageSize}),a=document.createElement("script"),b;a.src=h,e=document.getElementById("searchbar-script-container"),b=e.lastElementChild,b&&e.removeChild(b),e.appendChild(a)}function renderSearchResultEntry(a){var b='<div class="single-search-result"><h3><a href="'+a.link+'">'+a.title+'</a></h3>'+'<a href="'+a.link+'">'+a.htmlFormattedUrl+'</a>'+'<div class="result-description-wrapper">';return a.pagemap&&a.pagemap.cse_thumbnail&&(b+='<div class="result-thumb"><img src="'+a.pagemap.cse_thumbnail[0].src+'" alt="" />'+'</div>'),b+='<div class="result-description"><p>'+a.snippet+'</p>'+'</div>'+'</div>'+'</div>',b}function renderResult(a){var e,d,c,b;if(document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left"><p>About <span class="search-count">'+a.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+a.searchInformation.formattedSearchTime+' </span>seconds)'+'</p>'+'</div>',!a.items)return;e=document.querySelector(".search-result-wrapper"),e.innerHTML="";for(d=0;d<a.items.length;d++)e.innerHTML+=renderSearchResultEntry(a.items[d]);c='<ul>',a.queries.previousPage&&(b=Math.floor(a.queries.previousPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Previous</a></li>'),a.queries.request&&(b=Math.floor(a.queries.request[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')" class="is-active">'+b+'</a></li>'),a.queries.nextPage&&(b=Math.floor(a.queries.nextPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Next</a></li>'),c+='</ul>',document.querySelector(".pagination-area .pagination-list").innerHTML=c}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class="columns is-mobile is-multiline"><div class="column is-full-mobile is-one-third-desktop is-one-third-widescreen is-one-third-tablet" data-aos=fade-up><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form method=post action=https://listmonk.appscode.com/subscription/form id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input type=hidden id=afbbc name=l value=afbbc974-e163-4467-be49-040e399520f3>
<input class=input name=email id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:+1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>+1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=500><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://stash.run>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://kubeform.cloud>Kubeform</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=600><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Pricing</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=700><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=800><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>© 2021 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script src=https://unpkg.com/downloadjs@1.4.7/download.min.js></script><script src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><script src=/assets/js/main.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/9255943.js></script><script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date;(function(){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0,a.src='https://embed.tawk.to/5821e34b18d9f16af02864b7/default',a.charset='UTF-8',a.setAttribute('crossorigin','*'),b.parentNode.insertBefore(a,b)})()</script></body></html>